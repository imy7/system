name: æ›´æ–°IPv4æ•°æ®ï¼ˆæ ¼å¼ï¼šIP#å›½å®¶ä»£ç ï¼‰

on:
  schedule:
    - cron: "0 */24 * * *"  # æ¯6å°æ—¶è¿è¡Œä¸€æ¬¡
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update-ipv4:
    runs-on: ubuntu-latest

    steps:
    - name: æ£€æŸ¥ä»“åº“
      uses: actions/checkout@v3

    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: å®‰è£…ä¾èµ–
      run: pip install requests

    - name: è·å–å¹¶åˆå¹¶IPv4æ•°æ®
      run: python fetch_and_merge_ipv4.py

    - name: æäº¤æ›´æ”¹
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # ç¡®ä¿ç›®å½•å­˜åœ¨
        mkdir -p cmliu
        
        # ç§»åŠ¨æ–‡ä»¶åˆ°æ­£ç¡®ä½ç½®
        mv cmliu/ipv4.txt ./cmliu/ipv4.txt 2>/dev/ || true
        
        git add ./cmliu/ipv4.txt
        
        # åªæœ‰å½“æœ‰æ›´æ”¹æ—¶æ‰æäº¤
        if git diff --quiet --cached; then
          echo "ğŸ“Œ æ²¡æœ‰æ£€æµ‹åˆ°æ›´æ”¹ï¼Œä¸æäº¤"
        else
          git commit -m "auto: æ›´æ–°IPv4æ•°æ®ï¼ˆæ ¼å¼ï¼šIP#å›½å®¶ä»£ç ï¼‰ $(date +'%Y-%m-%d %H:%M')"
          git push
        fi
